# **Ограничения конфигураций 1С**



- Технические ограничения
- Использование COM-объектов на сервере 1С в конфигурациях магнит
    - Работа с MS Office
- Работа с Teradata
- Работа с MS Access
- Иные офисные программы
- Соединения с внешними СУБД используя ADODB
- Соединение с 1С
- Исполнение скриптов, взаимодействие с ОС
- Работа с оборудованием на сервере
- Работа с внешними компонентами
- Использование  объектов платформы
- Работа с сетевыми каталогами
- Работа с Active Directory
- Ограничения в работе железа
- Ограничения внешних обработок

**Технические ограничения**

1. Невозможность использования СУБД MS SQL:

[Работа кластера серверов под управлением операционной системы Linux](https://its.1c.ru/db/metod8dev/content/1526/hdoc/_top/linux%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80)

2. [Невозможность использования COM-объектов на сервере](https://its.1c.ru/db/v8321doc#bookmark:cs:TI000000079)

**Использование COM-объектов на сервере 1С**

Наиболее часто используемые COM-объекты:

**Работа с MS Office**

- Новый COMОбъект("Excel.Application")
- Новый COMОбъект("Word.Application")
- Новый COMОбъект("Outlook.Application")

Для обхода ограничения необходимо использовать один из пунктов ниже (в порядке приоритета)

Пересмотр реализации и вынос функционала на сторону клиента под управлением ОС Windows
- Замена реализации на возможности платформы 1С: Табличный документ, возможности, ограничения
- Использование Open Office и внешней компоненты 
- Парсинг и корректировка самого файла office Пример Excel Пример Excel Пример Word Пример Word https://ru.wikipedia.org/wiki/Office_Open_XML
- Работа с OpenOffice без COM Библиотека
- Использование выделенного сервера, для обработки документов office.

    - Подразумевается как вариант использования сервера под управлением ОС Windows, для обработки документов по COM, так и иные реализации, в виде программ, сервисов, служб, позволяющие централизовать выбранное решение
    - Для получения и обработки запроса, на сервере office, развернут web сервер
        - Сервер 1С посылается http запрос на сервер office, для обработки документа. Передается сам файл или путь на серверной шаре, а также инструкции по обработке документа
        - Сервер office обрабатывает документ и возвращает результат обратно на сервер 1С

**Работа с Teradata**

Для работы требуется установить на сервер 1С утилиту Bteq (Basic Teradata Query) - скачать на официальном сайте (входит в пакет утилит) teradata-tools-and-utilities-linux

Из 1С нужно запустить приложение:

- ТекстКоманды = "bteq -c UTF8 < <Имя_подготовленного_файла_скрипта> 1><Имя_файла_лога_выполнения> 2><Имя_файла_ошибок_выполнения>"; //bteq -c UTF8 < /home/shakun_dg/bteq_script_1.sql 1>/tmp/bteqout.tmp 2>/tmp/bteqlerr.tmp
- ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);
Имя_файла_лога_выполнения и Имя_файла_ошибок_выполнения в данном случае будут перезаписываться.

Имя_файла_ошибок_выполнения - если пустой, то ошибок не было

Имя_подготовленного_файла_скрипта - скрипт для утилиты bteq в кодировке UTF8, пример:

        .SET WIDTH 100000; --Ширина строки вывода
        .SET EXITONDELAY ON MAXREQTIME 300; --Таймаут 300с на подключение и выполнение запросов
        .LOGON <ip сервера>/<Логин>,<Пароль>; --Подключение к серверу
        .EXPORT REPORT FILE=/tmp/bteq_export_15.tmp; --Файл, куда будет выводиться результат выборки данных (SELECT...)
        .SET SEPARATOR "|"; --Разделитель данных
        .SET TITLEDASHES OFF; --Отключает горизонтальный разделитель между заголовком и данными
        SELECT TOP 100
                CODE AS Code,
                CNTR_NAME AS Name,
                CNTR_KIS_ID AS Id
        FROM
            V_CNTR_KIS;
        .EXPORT RESET; --Сброс настроек экспорта
        .LOGOFF; --Отключение от сервера

Если не было ошибок запуска приложения, то по итогу результат выполнения брать из файла экспорта.

Полное описание возможностей утилиты и ее команд: https://docs.teradata.com/r/Basic-Teradata-Query-Reference/October-2018/Introduction-to-BTEQ

**Работа с MS Access**

На сервере 1С должен быть установлен unixODBC

Также уставить утилиты и ODBC драйвер для работы с access:

    apt-get install mdbtools odbc-mdbtools, при этом драйвер сам пропишется в /etc/odbcinst.ini

Прописать подключение к базе access в /etc/odbc.ini

    [Spr_uslovia]
    Description = Spr_uslovia
    Driver      = MDBTools
    Database    = /home/shakun_dg/Spr_uslovia.accdb

Из 1С нужно запустить приложение:


- ТекстКоманды = "isql <DSN> -d"|" -n -b < <Имя_подготовленного_файла_скрипта> 1><Имя_файла_вывода_данных> 2><Имя_файла_ошибок_выполнения>";  //isql Spr_uslovia -d"|" -n -b < /home/ivanov_ii/access_script_1.sql 1>/tmp/access_export_1.tmp 2>/tmp/accesserr.tmp

- ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);

-d"|" - разделитель данных

-n - многострочный режим

-b - пакетный режим, запросы подаются из файла

Можно дополнительно использовать опцию -c, для вывода названия колонок. 

Все возможности isql тут: https://www.mankier.com/1/isql

Имя_файла_вывода_данных и Имя_файла_ошибок_выполнения в данном случае будут перезаписываться.

Имя_файла_ошибок_выполнения - если пустой, то ошибок не было

Имя_подготовленного_файла_скрипта - скрипт для утилиты  isql в кодировке UTF8, пример скрипта с несколькими запросами:

        SELECT
            ART_ID,
            "МинЦена"
        FROM
            "МинЦены"
        WHERE
            ART_ID = 15278201
            OR ART_ID = 15333361
        go
        SELECT TOP 10
            "Название_позиции",
            "Название_РЦ"
        FROM
            "ИН-АУТЫ"
        go

Обязательно в конце скрипта пустая строка, иначе не будет выполняться. Русские названия в кавычках.

Текущий драйвер очень много чего НЕ умеет: ни соединять, ни группировать, ни сортировать и тд, все недовозможности тут: https://www.mankier.com/1/mdb-sql

Платная версия (есть триал) альтернативного драйвера, которая скорее всего умеет все: https://www.easysoft.com/products/data_access/odbc-access-driver/index.html#section=tab-1

**Иные офисные программы**

- Новый COMОбъект("com.sun.star.ServiceManager")
- Новый COMОбъект("AcroPDF.PDF.1")

**Соединения с внешними СУБД используя ADODB**

- Новый COMОбъект("ADODB.Connection")
- Новый COMОбъект("ADODB.Command")
- Новый COMОбъект("ADODB.Stream")

Сценарии: прямые соединения с MS SQL, Oracle, Teradata, Active Directory, MS Access

Для обхода ограничения необходимо

1. Пересмотр интеграции
2. Использование [внешних источников данных 1С](https://its.1c.ru/db/v8321doc/bookmark/dev/TI000000837)

Заявлена возможность работы со следующими источниками данных:

- MSSQLServer
- PostgreSQL
- IBMDB2
- OracleDatabase
- MySQL
- MSSQLServerAnalysisServices
- OracleEssbase
- IBMInf
osphereWarehouse

Теоретически возможна работа с teradata и access, данные проверяются

**Соединение с 1С**

- Новый COMОбъект("V83.COMConnector")

Для обхода ограничения необходимо реализовать обмен между 1С-системами через http или web-сервисы

**Исполнение скриптов, взаимодействие с ОС**
- Новый COMОбъект("WScript.Shell")
- Новый COMОбъект("WScript.Network")
- Новый COMОбъект("Shell.Application")
- Новый COMОбъект("1CtoPowerShell")
- Новый COMОбъект("MSScriptControl.ScriptControl")
- Новый COMОбъект("Scripting.FileSystemObject")
- Новый COMОбъект("VBScript.RegExp")
- Новый COMОбъект("MSXML2.XMLSchemaCache.6.0")
- Новый COMОбъект("Msxml2.DOMDocument.4.0")
- Новый COMОбъект("SQLXMLBulkLoad.SQLXMLBulkload")
- Новый COMОбъект("WbemScripting.SWbemLocator")
- Новый COMОбъект("winmgmts")
- Новый COMОбъект("HtmlFile")
- Новый COMОбъект("LDAP://")
- Новый COMОбъект("TAXDOCPrt.TAXDOCPrint")
- Новый COMОбъект("WinSCP")
- Новый COMОбъект("CAPICOM.Store")
- Новый COMОбъект("CAdESCOM")
- Новый COMОбъект("WinHttp.WinHttpRequest.5.1")

Сценарии: получение настроек ОС, работа с дисками, выполнение команд, исполнение скриптов

**Работа с оборудованием на сервере**

Исследование не проводили

Для корректной работы оборудования необходимо наличие драйверов под Linux

**Работа с внешними компонентами**

Исследование приостановлено

Отсутствие кросс-платформенной поддержки у используемых компонент

| Имя компоненты             | Возможность использования в Linux                    | Приоритет исследования | Подключение                                                                                                                                                                                                                                                                                                                                                                                                                          | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------------|------------------------------------------------------|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Barcode                    | Работает                                             | Высокий                | ПодключениеВыполнено = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаПечатиШтрихкодов", "BarcodeSymbolicName"); Компонент = Новый("AddIn.BarcodeSymbolicName.Barcode");                                                                                                                                                                                                                                                          | Компонента из демонстрационной базы 21 платформы не подключается. Компоненты из "1С:WMS", последней БСП и последней БПО работают.                                                                                                                                                                                                                                                                                                                                             |
| QRCodeExtension            | Работает                                             | Высокий                | ПодключениеВыполнено = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаПечатиQRКода", "QR"); ВнешняяКомпонента = Новый("AddIn.QR.QRCodeExtension")                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| XMLDSignAddIn              | Работает                                             | Высокий                | Электронная подпись Подписание и проверка подписи XML-сообщений SOAP по стандарту XML Digital Signature (XMLDSig) доступна в операционной системе Linux, а также в веб-клиенте. Эти операции осуществляются с помощью имеющегося программного интерфейса общих модулей: o   ЭлектроннаяПодписьКлиент: процедура Подписать; o   ЭлектроннаяПодпись: функция ПроверитьПодпись; o   ЭлектроннаяПодписьКлиент: функция ПроверитьПодпись. | В БСП версии 2.4.6 появилась поддержка Linux для XMLDSig Примечание: В текущей 1С:WMS 4.6.2.48 используется БСП 2.4.3.61. Для работы XMLDSig в Linux - потребуется обновить БСП до 2.4.6 (не ниже)                                                                                                                                                                                                                                                                            |
| FuzzyStringMatchExtension  | Работает                                             | Высокий                | FuzzySearch = ОбщегоНазначения.ПодключитьКомпонентуИзМакета("FuzzyStringMatchExtension", "ОбщийМакет.КомпонентаПоискаСтрок");                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ToirAD                     | Не работает                                          | Средний                | Комп = ПодключитьВнешнююКомпоненту("ОбщийМакет.AddInToir", "ToirAD", ТипВнешнейКомпоненты.Native); Компонента = Новый("AddIn.ToirAD.AddInToir");                                                                                                                                                                                                                                                                                     | В "1С:ТОИР" используется компонента "AddInToir", которая НЕ содержит библиотек для Linux Библиотека не типовая, специфическая, используется для работы с Active Directory                                                                                                                                                                                                                                                                                                     |
| Licence                    | Работает                                             | Средний                | ПодключитьВнешнююКомпоненту("ОбщийМакет.слкКомпонентаЗащиты", "Licence", ТипВнешнейКомпоненты.Native); МенеджерЛицензии = Новый("AddIn.Licence.LicenceExtension20");                                                                                                                                                                                                                                                                 | Кроме компоненты требуется наличие сервера СЛК на сервере, его работа не тестировалась                                                                                                                                                                                                                                                                                                                                                                                        |
| STPrint                    | Не работает                                          | Высокий                |                                                                                                                                                                                                                                                                                                                                                                                                                                      | В WMS используется компонента "усКомпонентаSTPrint", которая НЕ содержит библиотек для Linux, Компонента используется для печати документов из ТСД, как вариант обхода - печать через FoxitReader                                                                                                                                                                                                                                                                             |
| CuneiForm                  | Не работает, можно использовать на клиенте с Windows | Низкий                 |                                                                                                                                                                                                                                                                                                                                                                                                                                      | В "1С:Документооборот" невозможно будет использовать распознавание изображений, т. к. программа CuneiForm, использующаяся для этой задачи, работает только в Windows. Картинки могут быть распознаны на клиентских компьютерах, использующих Windows. Для распознавания изображений можно использовать обработку «Автоматическое распознавание изображений». Она должна быть запущена из клиентского приложения, использующего Windows, с установленной программой CuneiForm. |
| Decl                       | Работает                                             | Низкий                 | ПодключитьВнешнююКомпоненту("ОбщийМакет.NameDecl", "NameDecl", ТипВнешнейКомпоненты.Native); ТекОбъект = Новый("AddIn.NameDecl.CNameDecl");                                                                                                                                                                                                                                                                                          | Ссылка на компоненту "NameDecl": https://its.1c.ru/db/metod8dev/content/5152/hdoc                                                                                                                                                                                                                                                                                                                                                                                             |
| ЭДОNative                  | Работает                                             | Низкий                 | Подключена = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаОбмена301", "ЭДОNative", ТипВнешнейКомпоненты.Native); ТекОбъект = Новый("Addin.ЭДОNative.CryptS")                                                                                                                                                                                                                                                                    | Компонента использована из "1С:ERP Управление предприятием 2" (2.5.8.1914)                                                                                                                                                                                                                                                                                                                                                                                                    |
| FECNSPK                    | Работает                                             | Низкий                 | ВнешняяКомпонента = ОбщегоНазначения.ПодключитьКомпонентуИзМакета("FECNSPK", "ОбщийМакет.КомпонентаИнтеграцииНСПК"); ПодключаемыйМодуль = Новый ("AddIn.FECNSPK.FECNSPK")                                                                                                                                                                                                                                                            | Протестировано в "1С:Библиотека подключаемого оборудования" (3.1.6.5)                                                                                                                                                                                                                                                                                                                                                                                                         |
| ETP                        | Работает                                             | Низкий                 | ИмяКомпонента = "ОбщийМакет.ОценкаПроизводительностиВнешнийКомпонент";                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |

**Примечание:** если в компоненте есть файл с расширением *.so и с текстом "64" в наименовании, то существует высокая вероятность, что компонента работает под 64-битный Linux.

Если выгрузить компоненту в файл и распаковать архив, в манифесте можно увидеть для какой ОС, типа и вида клиента компонента:

        ...
        etpl_x86_32_2_0_4_52.so
        etpl_x86_64_2_0_4_52.so
        ...
        manifest.xml

Например:
manifest.xml

        <?xml version="1.0" encoding="UTF-8"?>
        <bundle xmlns="http://v8.1c.ru/8.2/addin/bundle">
            …
            <component os="Linux" path="etpl_x86_32_2_0_4_52. so" type="native" arch="i386" />
            <component os="Linux" path="etpl_x86_64_2_0_4_52.so" type="native" arch="x86_64" />
        …
        </bundle>

Описание файла MANIFEST.XML на ИТС:
https://its.1c.ru/db/metod8dev#content:3221:hdoc:manifest

**Использование  объектов платформы**

Необходимости в исследовании нет т.к. объекты устаревшие

ИнтернетСоединение - Предназначен для доступа к Интернет-соединениям. Доступен только на компьютерах с установленным Internet Explorer версии 5.0 или выше 

Почта - Предназначен для доступа к почтовой системе, установленной на компьютере. Используется технология MAPI 

**Работа с сетевыми каталогами**

Сетевой каталог Windows нужно предварительно смонтировать (mount -t cifs ...). Дальнейшая работа с ним как с обычной папкой сервера.

[Особенности заполнения поля Полный путь для Linux (its.1c.ru)](https://its.1c.ru/db/bsp313doc#content:2061:1:issogl2_%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%B9_%D0%BF%D1%83%D1%82%D1%8C_%D0%B4%D0%BB%D1%8F_linux)

https://www.dmosk.ru/miniinstruktions.php?mini=linux-cifs

https://zalinux.ru/?p=3387

**Работа с Active Directory**

ВНИМАНИЕ!!!! VASD теперь не используется, необходимо использовать SSSD (команда sssctl)

Сервера на Linux уже разворачиваются с подключением к домену через сервисы QAS (Quest Authentification Services (One Identity)).

Для взаимодействия с доменом нужно использовать утилиту vastool из пакета QAS. Которая позволяет получать всю нужную информацию из Active Directory, а также добавлять, удалять пользователей/группы и тд

Полное описание возможностей тут: https://www.bashpi.org/?page_id=803

Из 1С нужно запустить приложение:


- ТекстКоманды = "/opt/quest/bin/vastool -q <команда_vastooll> 1>/tmp/vastoll_out.tmp"; // /opt/quest/bin/vastool -q user getgroups -p ivanov_ii 1>/tmp/ivanov_ii_groups.tmp
- ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);
