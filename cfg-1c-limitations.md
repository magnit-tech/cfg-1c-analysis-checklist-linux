# **Ограничения конфигураций 1С**

## **Технические ограничения**

1. **Невозможность использования СУБД MS SQL:**
   - [Работа кластера серверов под управлением операционной системы Linux](https://its.1c.ru/db/metod8dev/content/1526/hdoc/_top/linux%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80)

2. **Невозможность использования COM-объектов на сервере:**
   - [Документация по ограничениям](https://its.1c.ru/db/v8321doc#bookmark:cs:TI000000079)

## **Использование COM-объектов на сервере 1С**

Наиболее часто используемые COM-объекты:

### **Работа с MS Office**

- `Новый COMОбъект("Excel.Application")`
- `Новый COMОбъект("Word.Application")`
- `Новый COMОбъект("Outlook.Application")`

**Для обхода ограничения:**

1. **Пересмотр реализации и вынос функционала на сторону клиента под управлением ОС Windows**
2. **Замена реализации на возможности платформы 1С:**
   - Табличный документ
   - Возможности и ограничения
3. **Использование Open Office и внешней компоненты:**
   - [Пример Excel](https://example.com/excel)
   - [Пример Word](https://example.com/word)
   - [Работа с OpenOffice без COM](https://example.com/openoffice)
4. **Парсинг и корректировка самого файла Office:**
   - [Пример Excel](https://example.com/excel)
   - [Пример Word](https://example.com/word)
   - [Office Open XML](https://ru.wikipedia.org/wiki/Office_Open_XML)
5. **Использование выделенного сервера для обработки документов Office:**
   - Сервер под управлением ОС Windows
   - Web-сервер для получения и обработки запросов

### **Работа с Teradata**

**Требования:**
- Установка утилиты Bteq (Basic Teradata Query) на сервер 1С
- Скачать с официального сайта: [Teradata Tools and Utilities Linux](https://example.com/teradata-tools)

**Пример использования:**

```1c
ТекстКоманды = "bteq -c UTF8 < <Имя_подготовленного_файла_скрипта> 1><Имя_файла_лога_выполнения> 2><Имя_файла_ошибок_выполнения>";
ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);
```

**Пример скрипта для Bteq:**

```sql
.SET WIDTH 100000;
.SET EXITONDELAY ON MAXREQTIME 300;
.LOGON <ip сервера>/<Логин>,<Пароль>;
.EXPORT REPORT FILE=/tmp/bteq_export_15.tmp;
.SET SEPARATOR "|";
.SET TITLEDASHES OFF;
SELECT TOP 100
    CODE AS Code,
    CNTR_NAME AS Name,
    CNTR_KIS_ID AS Id
FROM
    V_CNTR_KIS;
.EXPORT RESET;
.LOGOFF;
```

**Полное описание возможностей Bteq:**
- [Basic Teradata Query Reference](https://docs.teradata.com/r/Basic-Teradata-Query-Reference/October-2018/Introduction-to-BTEQ)

### **Работа с MS Access**

**Требования:**
- Установка unixODBC на сервер 1С
- Установка утилит и ODBC драйвера для работы с Access:
  ```bash
  apt-get install mdbtools odbc-mdbtools
  ```

**Пример использования:**

```1c
ТекстКоманды = "isql <DSN> -d"|" -n -b < <Имя_подготовленного_файла_скрипта> 1><Имя_файла_вывода_данных> 2><Имя_файла_ошибок_выполнения>";
ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);
```

**Пример скрипта для isql:**

```sql
SELECT
    ART_ID,
    "МинЦена"
FROM
    "МинЦены"
WHERE
    ART_ID = 15278201
    OR ART_ID = 15333361
go
SELECT TOP 10
    "Название_позиции",
    "Название_РЦ"
FROM
    "ИН-АУТЫ"
go
```

**Полное описание возможностей isql:**
- [isql manual](https://www.mankier.com/1/isql)

**Ограничения текущего драйвера:**
- [mdb-sql limitations](https://www.mankier.com/1/mdb-sql)

**Альтернативный платяной драйвер:**
- [Easysoft ODBC Access Driver](https://www.easysoft.com/products/data_access/odbc-access-driver/index.html#section=tab-1)

### **Иные офисные программы**

- `Новый COMОбъект("com.sun.star.ServiceManager")`
- `Новый COMОбъект("AcroPDF.PDF.1")`

### **Соединения с внешними СУБД используя ADODB**

- `Новый COMОбъект("ADODB.Connection")`
- `Новый COMОбъект("ADODB.Command")`
- `Новый COMОбъект("ADODB.Stream")`

**Сценарии:**
- Прямые соединения с MS SQL, Oracle, Teradata, Active Directory, MS Access

**Для обхода ограничения:**
1. **Пересмотр интеграции**
2. **Использование внешних источников данных 1С:**
   - [Внешние источники данных 1С](https://its.1c.ru/db/v8321doc/bookmark/dev/TI000000837)

**Поддерживаемые источники данных:**
- MSSQLServer
- PostgreSQL
- IBMDB2
- OracleDatabase
- MySQL
- MSSQLServerAnalysisServices
- OracleEssbase
- IBMInfosphereWarehouse

**Теоретически возможна работа с Teradata и Access, данные проверяются**

### **Соединение с 1С**

- `Новый COMОбъект("V83.COMConnector")`

**Для обхода ограничения:**
- Реализовать обмен между 1С-системами через HTTP или веб-сервисы

### **Исполнение скриптов, взаимодействие с ОС**

- `Новый COMОбъект("WScript.Shell")`
- `Новый COMОбъект("WScript.Network")`
- `Новый COMОбъект("Shell.Application")`
- `Новый COMОбъект("1CtoPowerShell")`
- `Новый COMОбъект("MSScriptControl.ScriptControl")`
- `Новый COMОбъект("Scripting.FileSystemObject")`
- `Новый COMОбъект("VBScript.RegExp")`
- `Новый COMОбъект("MSXML2.XMLSchemaCache.6.0")`
- `Новый COMОбъект("Msxml2.DOMDocument.4.0")`
- `Новый COMОбъект("SQLXMLBulkLoad.SQLXMLBulkload")`
- `Новый COMОбъект("WbemScripting.SWbemLocator")`
- `Новый COMОбъект("winmgmts")`
- `Новый COMОбъект("HtmlFile")`
- `Новый COMОбъект("LDAP://")`
- `Новый COMОбъект("TAXDOCPrt.TAXDOCPrint")`
- `Новый COMОбъект("WinSCP")`
- `Новый COMОбъект("CAPICOM.Store")`
- `Новый COMОбъект("CAdESCOM")`
- `Новый COMОбъект("WinHttp.WinHttpRequest.5.1")`

**Сценарии:**
- Получение настроек ОС, работа с дисками, выполнение команд, исполнение скриптов

### **Работа с оборудованием на сервере**

**Исследование не проводили**

**Для корректной работы оборудования:**
- Необходимо наличие драйверов под Linux

### **Работа с внешними компонентами**

**Исследование приостановлено**

**Отсутствие кросс-платформенной поддержки у используемых компонент**

| Имя компоненты             | Возможность использования в Linux | Приоритет исследования | Подключение                                                                                                                                                                                                                                                                                                                                                                                                                          | Комментарий                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------------------|-----------------------------------|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Barcode                    | Работает                          | Высокий                | `ПодключениеВыполнено = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаПечатиШтрихкодов", "BarcodeSymbolicName"); Компонент = Новый("AddIn.BarcodeSymbolicName.Barcode");`                                                                                                                                                                                                                                                          | Компонента из демонстрационной базы 21 платформы не подключается. Компоненты из "1С:WMS", последней БСП и последней БПО работают.                                                                                                                                                                                                                                                                                                                                             |
| QRCodeExtension            | Работает                          | Высокий                | `ПодключениеВыполнено = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаПечатиQRКода", "QR"); ВнешняяКомпонента = Новый("AddIn.QR.QRCodeExtension")`                                                                                                                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| XMLDSignAddIn              | Работает                          | Высокий                | Электронная подпись Подписание и проверка подписи XML-сообщений SOAP по стандарту XML Digital Signature (XMLDSig) доступна в операционной системе Linux, а также в веб-клиенте. Эти операции осуществляются с помощью имеющегося программного интерфейса общих модулей: o   ЭлектроннаяПодписьКлиент: процедура Подписать; o   ЭлектроннаяПодпись: функция ПроверитьПодпись; o   ЭлектроннаяПодписьКлиент: функция ПроверитьПодпись. | В БСП версии 2.4.6 появилась поддержка Linux для XMLDSig Примечание: В текущей 1С:WMS 4.6.2.48 используется БСП 2.4.3.61. Для работы XMLDSig в Linux - потребуется обновить БСП до 2.4.6 (не ниже)                                                                                                                                                                                                                                                                            |
| FuzzyStringMatchExtension  | Работает                          | Высокий                | `FuzzySearch = ОбщегоНазначения.ПодключитьКомпонентуИзМакета("FuzzyStringMatchExtension", "ОбщийМакет.КомпонентаПоискаСтрок");`                                                                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ToirAD                     | Не работает                       | Средний                | `Комп = ПодключитьВнешнююКомпоненту("ОбщийМакет.AddInToir", "ToirAD", ТипВнешнейКомпоненты.Native); Компонента = Новый("AddIn.ToirAD.AddInToir");`                                                                                                                                                                                                                                                                                     | В "1С:ТОИР" используется компонента "AddInToir", которая НЕ содержит библиотек для Linux Библиотека не типовая, специфическая, используется для работы с Active Directory                                                                                                                                                                                                                                                                                                     |
| Licence                    | Работает                          | Средний                | `ПодключитьВнешнююКомпоненту("ОбщийМакет.слкКомпонентаЗащиты", "Licence", ТипВнешнейКомпоненты.Native); МенеджерЛицензии = Новый("AddIn.Licence.LicenceExtension20");`                                                                                                                                                                                                                                                                 | Кроме компоненты требуется наличие сервера СЛК на сервере, его работа не тестировалась                                                                                                                                                                                                                                                                                                                                                                                        |
| STPrint                    | Не работает                       | Высокий                |                                                                                                                                                                                                                                                                                                                                                                                                                                      | В WMS используется компонента "усКомпонентаSTPrint", которая НЕ содержит библиотек для Linux, Компонента используется для печати документов из ТСД, как вариант обхода - печать через FoxitReader                                                                                                                                                                                                                                                                             |
| CuneiForm                  | Не работает, можно использовать на клиенте с Windows | Низкий                 |                                                                                                                                                                                                                                                                                                                                                                                                                                      | В "1С:Документооборот" невозможно будет использовать распознавание изображений, т. к. программа CuneiForm, использующаяся для этой задачи, работает только в Windows. Картинки могут быть распознаны на клиентских компьютерах, использующих Windows. Для распознавания изображений можно использовать обработку «Автоматическое распознавание изображений». Она должна быть запущена из клиентского приложения, использующего Windows, с установленной программой CuneiForm. |
| Decl                       | Работает                          | Низкий                 | `ПодключитьВнешнююКомпоненту("ОбщийМакет.NameDecl", "NameDecl", ТипВнешнейКомпоненты.Native); ТекОбъект = Новый("AddIn.NameDecl.CNameDecl");`                                                                                                                                                                                                                                                                                          | Ссылка на компоненту "NameDecl": https://its.1c.ru/db/metod8dev/content/5152/hdoc                                                                                                                                                                                                                                                                                                                                                                                             |
| ЭДОNative                  | Работает                          | Низкий                 | `Подключена = ПодключитьВнешнююКомпоненту("ОбщийМакет.КомпонентаОбмена301", "ЭДОNative", ТипВнешнейКомпоненты.Native); ТекОбъект = Новый("Addin.ЭДОNative.CryptS")`                                                                                                                                                                                                                                                                    | Компонента использована из "1С:ERP Управление предприятием 2" (2.5.8.1914)                                                                                                                                                                                                                                                                                                                                                                                                    |
| FECNSPK                    | Работает                          | Низкий                 | `ВнешняяКомпонента = ОбщегоНазначения.ПодключитьКомпонентуИзМакета("FECNSPK", "ОбщийМакет.Компонента

## **Работа с сетевыми каталогами**

**Сетевой каталог Windows:**
- Предварительно смонтировать с помощью команды:
  ```bash
  mount -t cifs ...
  ```
- Дальнейшая работа с ним как с обычной папкой сервера.

**Особенности заполнения поля Полный путь для Linux:**
- [Особенности заполнения поля Полный путь для Linux (its.1c.ru)](https://its.1c.ru/db/bsp313doc#content:2061:1:issogl2_%D0%BE%D1%81%D0%BE%D0%B1%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8_%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F_%D0%BF%D0%BE%D0%BB%D1%8F_%D0%BF%D0%BE%D0%BB%D0%BD%D1%8B%D0%B9_%D0%BF%D1%83%D1%82%D1%8C_%D0%B4%D0%BB%D1%8F_linux)

**Полезные ссылки:**
- [Монтирование сетевых каталогов в Linux](https://www.dmosk.ru/miniinstruktions.php?mini=linux-cifs)
- [Монтирование сетевых каталогов в Linux (zalinux.ru)](https://zalinux.ru/?p=3387)

## **Работа с Active Directory**

**ВНИМАНИЕ:**
- VASD теперь не используется, необходимо использовать SSSD (команда `sssctl`).

**Сервера на Linux:**
- Уже разворачиваются с подключением к домену через сервисы QAS (Quest Authentification Services (One Identity)).

**Для взаимодействия с доменом:**
- Использовать утилиту `vastool` из пакета QAS.
- Позволяет получать всю нужную информацию из Active Directory, а также добавлять, удалять пользователей/группы и т.д.

**Пример использования:**

```1c
ТекстКоманды = "/opt/quest/bin/vastool -q <команда_vastooll> 1>/tmp/vastoll_out.tmp";
ЗапуститьПриложение(ТекстКоманды,,Истина,КодВозврата);
```

**Полное описание возможностей vastool:**
- [vastool manual](https://www.bashpi.org/?page_id=803)

## **Использование объектов платформы**

**Необходимости в исследовании нет:**
- Объекты устаревшие.

**ИнтернетСоединение:**
- Предназначен для доступа к Интернет-соединениям.
- Доступен только на компьютерах с установленным Internet Explorer версии 5.0 или выше.

**Почта:**
- Предназначен для доступа к почтовой системе, установленной на компьютере.
- Используется технология MAPI.

## **Работа с оборудованием на сервере**

**Исследование не проводили:**
- Для корректной работы оборудования необходимо наличие драйверов под Linux.

## **Работа с внешними компонентами**

**Исследование приостановлено:**
- Отсутствие кросс-платформенной поддержки у используемых компонент.

**Примечание:**
- Если в компоненте есть файл с расширением `.so` и с текстом "64" в наименовании, то существует высокая вероятность, что компонента работает под 64-битный Linux.
- В манифесте можно увидеть для какой ОС, типа и вида клиента компонента:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<bundle xmlns="http://v8.1c.ru/8.2/addin/bundle">
    …
    <component os="Linux" path="etpl_x86_32_2_0_4_52.so" type="native" arch="i386" />
    <component os="Linux" path="etpl_x86_64_2_0_4_52.so" type="native" arch="x86_64" />
…
</bundle>
```

**Описание файла MANIFEST.XML на ИТС:**
- [MANIFEST.XML на ИТС](https://its.1c.ru/db/metod8dev#content:3221:hdoc:manifest)

## **Заключение**

При переводе конфигураций 1С на ОС Linux необходимо учитывать технические ограничения и заменять или пересматривать использование COM-объектов и других несовместимых компонентов. Использование альтернативных решений, таких как внешние источники данных 1С, веб-сервисы и другие методы интеграции, позволит обеспечить бесперебойную работу системы на новой платформе.
